<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rusty Gun Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 300;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.9;
      }

      .content {
        padding: 30px;
      }

      .tabs {
        display: flex;
        margin-bottom: 30px;
        border-bottom: 2px solid #e1e5e9;
      }

      .tab {
        padding: 15px 30px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        font-weight: 600;
        color: #666;
      }

      .tab.active {
        border-bottom-color: #667eea;
        color: #667eea;
      }

      .tab:hover {
        color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .section {
        margin-bottom: 40px;
        padding: 25px;
        background: #f8f9fa;
        border-radius: 15px;
        border-left: 5px solid #667eea;
      }

      .section h2 {
        color: #333;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #555;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e5e9;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-right: 10px;
        margin-bottom: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-secondary {
        background: #6c757d;
      }

      .btn-success {
        background: #28a745;
      }

      .btn-danger {
        background: #dc3545;
      }

      .results {
        margin-top: 20px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        border: 1px solid #e1e5e9;
      }

      .result-item {
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .result-item:last-child {
        margin-bottom: 0;
      }

      .result-score {
        display: inline-block;
        background: #667eea;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        margin-bottom: 8px;
      }

      .result-id {
        font-weight: 600;
        color: #333;
        margin-bottom: 5px;
      }

      .result-text {
        color: #666;
        margin-bottom: 8px;
      }

      .result-metadata {
        font-size: 12px;
        color: #888;
        background: #e9ecef;
        padding: 5px 8px;
        border-radius: 4px;
        display: inline-block;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .stat-value {
        font-size: 2em;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #666;
        font-size: 14px;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: #666;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        border: 1px solid #f5c6cb;
      }

      .success {
        background: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        border: 1px solid #c3e6cb;
      }

      .demo-data {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .demo-data h3 {
        color: #1976d2;
        margin-bottom: 10px;
      }

      .demo-data p {
        color: #666;
        margin-bottom: 5px;
      }

      .api-test {
        background: #fff3cd;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .api-test h3 {
        color: #856404;
        margin-bottom: 10px;
      }

      .endpoint {
        background: white;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 10px;
        font-family: "Courier New", monospace;
        font-size: 14px;
      }

      .method {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: 600;
        margin-right: 10px;
      }

      .method-get {
        background: #28a745;
        color: white;
      }
      .method-post {
        background: #007bff;
        color: white;
      }
      .method-put {
        background: #ffc107;
        color: black;
      }
      .method-delete {
        background: #dc3545;
        color: white;
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 15px;
        }

        .header {
          padding: 20px;
        }

        .header h1 {
          font-size: 2em;
        }

        .content {
          padding: 20px;
        }

        .tabs {
          flex-wrap: wrap;
        }

        .tab {
          padding: 10px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üéÆ Rusty Gun Demo</h1>
        <p>Interactive demonstration of Rusty Gun's powerful features</p>
      </div>

      <div class="content">
        <!-- Tabs -->
        <div class="tabs">
          <div class="tab active" onclick="showTab('vector')">
            Vector Search
          </div>
          <div class="tab" onclick="showTab('graph')">Graph Database</div>
          <div class="tab" onclick="showTab('api')">API Testing</div>
          <div class="tab" onclick="showTab('websocket')">WebSocket</div>
        </div>

        <!-- Vector Search Tab -->
        <div id="vector" class="tab-content active">
          <div class="demo-data">
            <h3>üìö Vector Search Demo</h3>
            <p>
              This demo showcases Rusty Gun's semantic search capabilities
              powered by HNSW and embeddings.
            </p>
            <p>
              Try searching for terms like "machine learning", "artificial
              intelligence", or "data science".
            </p>
          </div>

          <div class="section">
            <h2>üîç Semantic Search</h2>
            <div class="form-group">
              <label for="searchQuery">Search Query</label>
              <input
                type="text"
                id="searchQuery"
                placeholder="Enter your search query..."
                value="machine learning algorithms"
              >
            </div>
            <div class="form-group">
              <label for="searchLimit">Results Limit</label>
              <input type="number" id="searchLimit" value="5" min="1" max="20">
            </div>
            <div class="form-group">
              <label for="searchThreshold">Similarity Threshold</label>
              <input
                type="range"
                id="searchThreshold"
                min="0"
                max="1"
                step="0.1"
                value="0.3"
              >
              <span id="thresholdValue">0.3</span>
            </div>
            <button class="btn" onclick="performVectorSearch()">Search</button>
            <button class="btn btn-secondary" onclick="loadSampleData()">
              Load Sample Data
            </button>
          </div>

          <div id="vectorResults" class="results" style="display: none">
            <h3>Search Results</h3>
            <div id="vectorResultsList"></div>
          </div>
        </div>

        <!-- Graph Database Tab -->
        <div id="graph" class="tab-content">
          <div class="demo-data">
            <h3>üìä Graph Database Demo</h3>
            <p>
              This demo showcases Rusty Gun's graph database capabilities with
              nodes, relationships, and queries.
            </p>
          </div>

          <div class="section">
            <h2>‚ûï Create Node</h2>
            <div class="form-group">
              <label for="nodeId">Node ID</label>
              <input type="text" id="nodeId" placeholder="Enter node ID">
            </div>
            <div class="form-group">
              <label for="nodeData">Node Data (JSON)</label>
              <textarea
                id="nodeData"
                placeholder='{"name": "Example Node", "type": "document"}'
              ></textarea>
            </div>
            <button class="btn" onclick="createNode()">Create Node</button>
            <button class="btn btn-success" onclick="createSampleNodes()">
              Create Sample Nodes
            </button>
          </div>

          <div class="section">
            <h2>üîç Search Nodes</h2>
            <div class="form-group">
              <label for="graphQuery">Search Query</label>
              <input
                type="text"
                id="graphQuery"
                placeholder="Enter search query..."
              >
            </div>
            <button class="btn" onclick="searchNodes()">Search</button>
            <button class="btn btn-secondary" onclick="listAllNodes()">
              List All Nodes
            </button>
          </div>

          <div id="graphResults" class="results" style="display: none">
            <h3>Graph Results</h3>
            <div id="graphResultsList"></div>
          </div>
        </div>

        <!-- API Testing Tab -->
        <div id="api" class="tab-content">
          <div class="api-test">
            <h3>üîå API Testing</h3>
            <p>
              Test various API endpoints and see the responses in real-time.
            </p>
          </div>

          <div class="section">
            <h2>üìä Server Status</h2>
            <button class="btn" onclick="testHealth()">Health Check</button>
            <button class="btn" onclick="testStatus()">Server Status</button>
            <button class="btn" onclick="testMetrics()">Metrics</button>
          </div>

          <div class="section">
            <h2>üîç Available Endpoints</h2>
            <div class="endpoint">
              <span class="method method-get">GET</span>
              <span>/health</span>
            </div>
            <div class="endpoint">
              <span class="method method-get">GET</span>
              <span>/status</span>
            </div>
            <div class="endpoint">
              <span class="method method-get">GET</span>
              <span>/metrics</span>
            </div>
            <div class="endpoint">
              <span class="method method-get">GET</span>
              <span>/nodes</span>
            </div>
            <div class="endpoint">
              <span class="method method-post">POST</span>
              <span>/nodes</span>
            </div>
            <div class="endpoint">
              <span class="method method-post">POST</span>
              <span>/api/vector/search/text</span>
            </div>
            <div class="endpoint">
              <span class="method method-post">POST</span>
              <span>/api/vector/embedding</span>
            </div>
          </div>

          <div id="apiResults" class="results" style="display: none">
            <h3>API Response</h3>
            <pre id="apiResponse"></pre>
          </div>
        </div>

        <!-- WebSocket Tab -->
        <div id="websocket" class="tab-content">
          <div class="demo-data">
            <h3>üåê WebSocket Demo</h3>
            <p>
              Real-time communication with Rusty Gun using WebSocket
              connections.
            </p>
          </div>

          <div class="section">
            <h2>üîå WebSocket Connection</h2>
            <div class="form-group">
              <label for="wsChannel">Channel</label>
              <input
                type="text"
                id="wsChannel"
                placeholder="Enter channel name"
                value="demo"
              >
            </div>
            <button class="btn" onclick="connectWebSocket()">Connect</button>
            <button class="btn btn-danger" onclick="disconnectWebSocket()">
              Disconnect
            </button>
          </div>

          <div class="section">
            <h2>üí¨ Send Message</h2>
            <div class="form-group">
              <label for="wsMessage">Message</label>
              <textarea
                id="wsMessage"
                placeholder='{"type": "message", "data": "Hello World"}'
              ></textarea>
            </div>
            <button class="btn" onclick="sendWebSocketMessage()">
              Send Message
            </button>
          </div>

          <div id="wsResults" class="results" style="display: none">
            <h3>WebSocket Messages</h3>
            <div id="wsMessages"></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let ws = null;
      let wsChannel = "demo";

      // Tab switching
      function showTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll(".tab-content").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Remove active class from all tabs
        document.querySelectorAll(".tab").forEach((tab) => {
          tab.classList.remove("active");
        });

        // Show selected tab content
        document.getElementById(tabName).classList.add("active");

        // Add active class to clicked tab
        event.target.classList.add("active");
      }

      // Update threshold value display
      document.getElementById("searchThreshold").addEventListener(
        "input",
        function () {
          document.getElementById("thresholdValue").textContent =
            this.value;
        },
      );

      // Vector Search Functions
      async function performVectorSearch() {
        const query = document.getElementById("searchQuery").value;
        const limit = parseInt(
          document.getElementById("searchLimit").value,
        );
        const threshold = parseFloat(
          document.getElementById("searchThreshold").value,
        );

        if (!query.trim()) {
          showMessage("Please enter a search query", "error");
          return;
        }

        try {
          const response = await fetch("/api/vector/search/text", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: query,
              limit: limit,
              threshold: threshold,
            }),
          });

          const result = await response.json();

          if (result.success) {
            displayVectorResults(result.data);
          } else {
            showMessage(`Search error: ${result.error}`, "error");
          }
        } catch (error) {
          showMessage(`Search failed: ${error.message}`, "error");
        }
      }

      function displayVectorResults(data) {
        const resultsDiv = document.getElementById("vectorResults");
        const resultsList = document.getElementById(
          "vectorResultsList",
        );

        resultsDiv.style.display = "block";

        if (data.results.length === 0) {
          resultsList.innerHTML =
            "<p>No results found. Try adjusting your search query or threshold.</p>";
          return;
        }

        let html =
          `<p><strong>Found ${data.results.length} results for "${data.query}"</strong></p>`;

        data.results.forEach((result) => {
          html += `
                    <div class="result-item">
                        <span class="result-score">${
            (result.score * 100).toFixed(1)
          }% similar</span>
                        <div class="result-id">ID: ${result.id}</div>
                        <div class="result-text">${
            result.metadata.title || "No title"
          }</div>
                        <div class="result-metadata">${
            JSON.stringify(result.metadata, null, 2)
          }</div>
                    </div>
                `;
        });

        resultsList.innerHTML = html;
      }

      async function loadSampleData() {
        const sampleData = [
          {
            id: "doc1",
            text:
              "Machine learning is a subset of artificial intelligence that focuses on algorithms that can learn from data without being explicitly programmed.",
            metadata: {
              "type": "document",
              "category": "AI",
              "title": "Introduction to Machine Learning",
            },
          },
          {
            id: "doc2",
            text:
              "Deep learning uses neural networks with multiple layers to model and understand complex patterns in data.",
            metadata: {
              "type": "document",
              "category": "AI",
              "title": "Deep Learning Fundamentals",
            },
          },
          {
            id: "doc3",
            text:
              "Data science combines statistics, programming, and domain expertise to extract insights from data.",
            metadata: {
              "type": "document",
              "category": "Data Science",
              "title": "Data Science Overview",
            },
          },
        ];

        try {
          const response = await fetch("/api/vector/text/batch", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ items: sampleData }),
          });

          const result = await response.json();

          if (result.success) {
            showMessage("Sample data loaded successfully!", "success");
          } else {
            showMessage(`Error: ${result.error}`, "error");
          }
        } catch (error) {
          showMessage(
            `Error loading sample data: ${error.message}`,
            "error",
          );
        }
      }

      // Graph Database Functions
      async function createNode() {
        const id = document.getElementById("nodeId").value;
        const dataText = document.getElementById("nodeData").value;

        if (!id.trim() || !dataText.trim()) {
          showMessage("Please enter both ID and data", "error");
          return;
        }

        let data;
        try {
          data = JSON.parse(dataText);
        } catch (e) {
          showMessage("Invalid JSON in data field", "error");
          return;
        }

        try {
          const response = await fetch("/nodes", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: id,
              data: data,
              metadata: {},
              tags: [],
            }),
          });

          const result = await response.json();

          if (result.success) {
            showMessage("Node created successfully!", "success");
            document.getElementById("nodeId").value = "";
            document.getElementById("nodeData").value = "";
          } else {
            showMessage(`Error: ${result.error}`, "error");
          }
        } catch (error) {
          showMessage(`Error creating node: ${error.message}`, "error");
        }
      }

      async function createSampleNodes() {
        const sampleNodes = [
          { id: "node1", data: { name: "Alice", type: "person" } },
          { id: "node2", data: { name: "Bob", type: "person" } },
          {
            id: "node3",
            data: { name: "Project Alpha", type: "project" },
          },
        ];

        for (const node of sampleNodes) {
          try {
            const response = await fetch("/nodes", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                id: node.id,
                data: node.data,
                metadata: {},
                tags: [],
              }),
            });

            const result = await response.json();
            if (!result.success) {
              console.error(
                `Failed to create node ${node.id}:`,
                result.error,
              );
            }
          } catch (error) {
            console.error(`Error creating node ${node.id}:`, error);
          }
        }

        showMessage("Sample nodes created!", "success");
      }

      async function searchNodes() {
        const query = document.getElementById("graphQuery").value;

        if (!query.trim()) {
          showMessage("Please enter a search query", "error");
          return;
        }

        try {
          const response = await fetch("/nodes/search", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              query: query,
              limit: 10,
            }),
          });

          const result = await response.json();

          if (result.success) {
            displayGraphResults(result.data);
          } else {
            showMessage(`Search error: ${result.error}`, "error");
          }
        } catch (error) {
          showMessage(`Search failed: ${error.message}`, "error");
        }
      }

      async function listAllNodes() {
        try {
          const response = await fetch("/nodes");
          const result = await response.json();

          if (result.success) {
            displayGraphResults({
              nodes: result.data,
              total: result.data.length,
              query: "all nodes",
            });
          } else {
            showMessage(`Error: ${result.error}`, "error");
          }
        } catch (error) {
          showMessage(`Error: ${error.message}`, "error");
        }
      }

      function displayGraphResults(data) {
        const resultsDiv = document.getElementById("graphResults");
        const resultsList = document.getElementById("graphResultsList");

        resultsDiv.style.display = "block";

        if (data.nodes.length === 0) {
          resultsList.innerHTML = "<p>No nodes found.</p>";
          return;
        }

        let html =
          `<p><strong>Found ${data.total} nodes for "${data.query}"</strong></p>`;

        data.nodes.forEach((node) => {
          html += `
                    <div class="result-item">
                        <div class="result-id">ID: ${node.id}</div>
                        <div class="result-text">Data: ${
            JSON.stringify(node.data, null, 2)
          }</div>
                        <div class="result-metadata">Created: ${
            new Date(node.created_at).toLocaleString()
          }</div>
                    </div>
                `;
        });

        resultsList.innerHTML = html;
      }

      // API Testing Functions
      async function testHealth() {
        await testEndpoint("/health", "GET");
      }

      async function testStatus() {
        await testEndpoint("/status", "GET");
      }

      async function testMetrics() {
        await testEndpoint("/metrics", "GET");
      }

      async function testEndpoint(url, method) {
        try {
          const response = await fetch(url, { method });
          const data = await response.json();

          displayApiResponse(data);
        } catch (error) {
          displayApiResponse({ error: error.message });
        }
      }

      function displayApiResponse(data) {
        const resultsDiv = document.getElementById("apiResults");
        const responseDiv = document.getElementById("apiResponse");

        resultsDiv.style.display = "block";
        responseDiv.textContent = JSON.stringify(data, null, 2);
      }

      // WebSocket Functions
      function connectWebSocket() {
        wsChannel = document.getElementById("wsChannel").value ||
          "demo";

        if (ws) {
          ws.close();
        }

        const protocol = window.location.protocol === "https:"
          ? "wss:"
          : "ws:";
        const wsUrl =
          `${protocol}//${window.location.host}/ws/${wsChannel}`;

        ws = new WebSocket(wsUrl);

        ws.onopen = function () {
          showMessage("WebSocket connected!", "success");
          addWebSocketMessage("Connected to channel: " + wsChannel);
        };

        ws.onmessage = function (event) {
          addWebSocketMessage("Received: " + event.data);
        };

        ws.onclose = function () {
          showMessage("WebSocket disconnected", "error");
          addWebSocketMessage(
            "Disconnected from channel: " + wsChannel,
          );
        };

        ws.onerror = function (error) {
          showMessage("WebSocket error: " + error, "error");
        };
      }

      function disconnectWebSocket() {
        if (ws) {
          ws.close();
          ws = null;
        }
      }

      function sendWebSocketMessage() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          showMessage("WebSocket not connected", "error");
          return;
        }

        const messageText = document.getElementById("wsMessage").value;
        if (!messageText.trim()) {
          showMessage("Please enter a message", "error");
          return;
        }

        try {
          const message = JSON.parse(messageText);
          ws.send(JSON.stringify(message));
          addWebSocketMessage("Sent: " + messageText);
        } catch (e) {
          // Send as plain text if not valid JSON
          ws.send(messageText);
          addWebSocketMessage("Sent: " + messageText);
        }
      }

      function addWebSocketMessage(message) {
        const resultsDiv = document.getElementById("wsResults");
        const messagesDiv = document.getElementById("wsMessages");

        resultsDiv.style.display = "block";

        const messageDiv = document.createElement("div");
        messageDiv.className = "result-item";
        messageDiv.textContent = new Date().toLocaleTimeString() +
          ": " + message;

        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      // Utility Functions
      function showMessage(message, type) {
        // Create a temporary message element
        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;
        messageDiv.style.position = "fixed";
        messageDiv.style.top = "20px";
        messageDiv.style.right = "20px";
        messageDiv.style.zIndex = "1000";
        messageDiv.style.padding = "15px";
        messageDiv.style.borderRadius = "8px";
        messageDiv.style.maxWidth = "300px";

        document.body.appendChild(messageDiv);

        setTimeout(() => {
          document.body.removeChild(messageDiv);
        }, 5000);
      }

      // Load sample data on page load
      window.addEventListener("load", function () {
        loadSampleData();
      });
    </script>
  </body>
</html>
